{% extends 'base.html' %}
{% load html_filters %}
{% load static %}
{% load crispy_forms_tags %}

{% block extra_title %}: Collection Detail{% endblock %}

{% block content %}
<!-- Collection detail -->
<section class="collection-name">
    <h2> Your Collection: {{ collection.name }}</h2>
    <p> {{ collection.excerpt }}</p>
</section>

<div class="form row heading">
    {% if collection and user.is_authenticated and user == collection.user %}
    <div class="col-sm-4 align-items-center">
        <p class="mb-0">Update your collection:</p>
    </div>
    <!-- Edit Collection -->
    <div class="edit-collection col-sm-4">
        <a href="{% url 'edit_collection' collection.slug %}" aria-label="Go to the page for editing this collection"
            class="btn btn-sm edit-button icon-button" title="Edit collection">
            <i class="fa-solid fa-pen-to-square icon"></i>Edit collection
        </a>
    </div>
    <!-- Delete Collection -->
    <div class="delete-collection col-sm-4">
        <a href="{% url 'delete_collection' collection.slug %}" aria-label="Go to the page for deleting this collection"
            class="btn btn-danger btn-sm icon-button delete-button">
            <i class="fa-solid btn-sm fa-delete-left icon"></i>Delete collection
        </a>
    </div>
    {% endif %}
</div>

<div class="additonal-forms row align-items-center">
    {% if collection.books.exists %}
    <!-- Add Book Form -->
    <div class="col-sm-6">
        <a href="{% url 'add_book' collection.slug %}" aria-label="Go to the page for adding a book to this collection"
            class="btn btn-sm icon-button add-button">
            <i class="fa-solid fa-plus icon"></i> Add a book to your collection
        </a>
    </div>

    <!-- Filter book based on author -->
    {% if authors %}
    <form method="get" class="filter col-sm-6">
        <label for="author" class="filter-text">Filter by author:</label>
        <select class="drop-down" name="author" id="author" title="authors">
            <option value="">All Authors</option>
            {% for a in authors %}
            <option value="{{ a }}" {% if selected_author == a %}selected{% endif %}>
                {{ a }}
            </option>
            {% endfor %}
        </select>
        <button type="submit" class="filter-button">Filter</button>
    </form>
    {% endif %}
    {% endif %}
</div>



<!-- Book container -->
<div class="book-summary container mt-4">
    <div class="row">
        {% if books %}
        {% for book in books %}
        <!-- Column wrapper -->
        <div class="col-12 col-md-4 mb-4">
            <!-- Card inside column -->
            <div class="card book h-100">
                <div class="card-header book-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0 h6">Book by: {{ book.author }}</h3>
                </div>
                <div class="card-body book-body">
                    <h4 class="card-title book-title h5">{{ book.title }}</h4>
                    <p class="tags mb-2">
                        <p class="tags mb-2">
                            {% for t in book.tag.all %}
                            <span class="badge bg-secondary">{{ t.name }}</span>
                            {% empty %}
                            <span class="text-muted">No tags</span>
                            {% endfor %}
                        </p>
                    </p>
                    <p class="card-text book-text mb-2">
                        {{ book.body|clean_html }}
                    </p>
                    <p class="mb-0">
                        Status: {% if book.finished %} Finished {% else %} In progress {% endif %}
                    </p>
                </div>
                <div class="card-footer book-footer d-flex justify-content-between align-items-center">
                    {% if collection and user.is_authenticated and user == collection.user %}
                    <a href="{% url 'edit_book' slug=collection.slug book_id=book.id %}"
                        aria-label="Go to the page for editing this book" class="btn btn-sm edit-button icon-button"
                        title="Edit book">
                        <i class="fa-solid fa-pen-to-square icon"></i>Edit book
                    </a>
                    <a href="{% url 'delete_book' slug=collection.slug book_id=book.id %}"
                        aria-label="Go to the page for deleting this book"
                        class="btn btn-sm delete-button btn-danger icon-button" title="Delete book">
                        <i class="fa-solid fa-delete-left icon"></i>Delete book
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="no-books text-center mt-4">
            <p>No books in this collection yet.</p>
            <div class="form add-book">
                <a href="{% url 'add_book' collection.slug %}"
                    aria-label="Go to the page for adding a book to this collection"
                    class="btn btn-sm icon-button add-button">
                    <i class="fa-solid fa-plus icon"></i> Add your first book to this collection
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

{% endblock content %}